{% extends "base.html" %}

{% block title %}Dashboard - TerraScope Console{% endblock %}

{% block content %}
<div class="mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
        <span class="ts-pill mb-1">
            <span class="dot"></span>
            Subscriber Dashboard
        </span>
        <h1 class="h4 text-light mb-0">Welcome back, {{ user.username }}</h1>
        <p class="ts-muted mb-0">
            Overview of your active TerraScope subscriptions and observation metrics.
        </p>
    </div>
</div>

<div class="row g-4 mt-1">
    <!-- Subscriptions card -->
    <div class="col-lg-6">
        <div class="ts-card-soft p-3 p-md-4 h-100">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 text-light mb-0">Your subscriptions</h2>
                <span class="ts-tag">
                    {{ subs|length }} total
                </span>
            </div>

            {% if subs %}
                <ul class="list-unstyled mt-3 mb-0">
                    {% for sub in subs %}
                        <li class="mb-2">
                            <div class="d-flex justify-content-between align-items-center ts-metric-row">
                                <div>
                                    <div class="fw-semibold text-light">
                                        {{ sub.product.name }}
                                    </div>
                                    <div class="ts-muted small">
                                        Subscribed on {{ sub.subscribed_at|date:"Y-m-d H:i" }}
                                    </div>
                                </div>
                                <div>
                                    {% if sub.status == 'active' %}
                                        <span class="ts-badge-sub bg-sub-active">Active</span>
                                    {% elif sub.status == 'pending' %}
                                        <span class="ts-badge-sub bg-sub-pending">Pending</span>
                                    {% else %}
                                        <span class="ts-badge-sub bg-sub-expired">Expired</span>
                                    {% endif %}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="ts-empty mt-3 mb-1">
                    You don’t have any subscriptions yet.
                </p>
                <a href="{% url 'home' %}" class="btn btn-sm btn-outline-light rounded-pill mt-2">
                    Browse products
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Metrics card -->
    <div class="col-lg-6">
        <div class="ts-card p-3 p-md-4 h-100">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 text-light mb-0">Observation metrics</h2>
                <span class="ts-tag ts-tag--accent">
                    Flask API /observations
                </span>
            </div>

            {% if metrics %}
                <div class="mt-3">
                    {% for satellite, count in metrics.items %}
                        <div class="ts-metric-row">
                            <div class="ts-metric-name">
                                {{ satellite }}
                            </div>
                            <div class="ts-metric-count">
                                {{ count }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="ts-empty mt-3 mb-1">
                    No metrics available — this usually means the API returned an empty list
                    or the JWT token is missing.
                </p>
                <p class="ts-muted small mb-0">
                    Use Postman or your test scripts to insert some observations, then refresh.
                </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
